<h3>Comments for {{ project.title }}</h3>

{% if user.is_authenticated %}
  <form method="post" action="{% url 'comment_create' id=project.id %}">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="form-group">
      {{ form.content.errors }}
      {{ form.content }}
    </div>
    <button type="submit" class="btn">Post comment</button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}">Log in</a> to write a comment.</p>
{% endif %}

<ul class="comment-list">
  {% for c in comments %}
    <li class="comment-item">
      <div class="comment-header">
        <strong>{{ c.user.username }}</strong>
        <span class="comment-date">{{ c.created_at|date:"Y-m-d H:i" }}</span>
      </div>
      <p class="comment-content">{{ c.content }}</p>

      {% if user.is_authenticated and (c.user_id == user.id or user.is_staff) %}
        <form method="post" action="{% url 'comment_delete' id=project.id comment_id=c.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">Delete</button>
        </form>
        <a href="{% url 'comment_edit' id=project.id comment_id=c.id %}" class="btn btn-edit">Edit</a>
      {% endif %}
    </li>
  {% empty %}
    <li>No comments yet.</li>
  {% endfor %}
</ul>
